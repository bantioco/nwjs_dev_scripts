<div>
    <div class="data-bloc-title"></div>
    <div class="data-load-bloc"></div>
</div>

<script>
(function( $ ){
    $(document).ready(function(){

        var fs = require('fs');

        fs.open('data/data_scripts.json', 'r+', (err, fd) => {
            if( err || fd == undefined ){
                file_not_exist();
            }
            else{
                view_data();
            }
        });

        function view_data(){
            var selected0 = $('.selected-list').attr('id');
            if( selected0 != null && selected0 != undefined ){

                var selected1 = selected0.split('_'), selected = selected1[1];
                $.getJSON( 'data/data_scripts.json',function( getdata ){
                    $.each( getdata.data, function( key, val ) {
                        if(key == selected){ append_bloc_data(key, val, getdata); }
                    });
                });

            }
            else{
                selected = 0;
                $.getJSON( 'data/data_scripts.json',function( getdata ){
                    $.each( getdata.data, function( key, val ) {
                        if(key == selected){ append_bloc_data(key, val, getdata); }
                    });
                });
            }

            // Append bloc data function
            function append_bloc_data(key, val, getdata){

                var data_bloc_title =
                    "<div class='data-bloc-title-i'><i class='devicon-" +val.category+ "-plain colored'></i></div> <div class='data-bloc-title-s'>" + val.title + "</div>";
                $('.data-bloc-title').html( data_bloc_title );

                var bloc_data =
                    "<div id='bloclist_" + key + "' class='bloc-data'>"+
                        "<div class='bloc-data-topbar'>"+
                            "<div class='bloc-data-topbar-r'><i class='fa fa-trash bt-bloc-delete' aria-hidden='true'></i></div>"+
                            "<div class='bloc-data-topbar-r'><i class='fa fa-pencil' aria-hidden='true'></i></div>"+
                        "</div>"+
                        "<div id='deletebloc_" + key + "' class='bloc-data-confirm-delete'>"+
                            "<span>Delete data ?</span> <button class='delete-confirm'>YES</button> <button class='delete-cancel'>NO</button>"+
                        "</div>"+
                        "<div class='bloc-data-content'>"+
                            "<div class='bloc-data-category'>" + val.category + "</div>"+
                            "<div class='bloc-data-text'>" + val.text + "</div>"+
                        "</div>"+
                    "</div>";
                $('.data-load-bloc').append( bloc_data );

                $('pre').addClass('line-numbers');

                setTimeout(function(){ Prism.highlightAll(); },100);

                setTimeout(function(){
                    $('.bt-bloc-delete').on('click', function(){
                        var id0 = $(this).parent().parent().parent().attr('id'), id1 = id0.split('_'), id = id1[1];
                        if( $('#deletebloc_' + id).is(':hidden') ){
                            $('#deletebloc_' + id).slideDown(500);
                            $('.delete-cancel').on('click', function(){ $('#deletebloc_' + id).slideUp(500); });
                            $('.delete-confirm').on('click', function(){
                                getdata.data.splice(id,1);
                                setTimeout(function(){
                                   fs.writeFile('data/data_scripts.json', JSON.stringify( getdata ), (err) => {
                                      if (err) throw err;
                                      console.log('It\'s saved!');
                                      $.post('./load/load_data_list.html', function( datalist ){ $('.js-load-data-list').html( datalist ); });
                                      $.post('./load/load_data.html', function( datadetail ){ $('.js-load-page').html( datadetail ); });
                                    });
                                },500);
                            });
                        }
                        else{ $('#deletebloc_' + id).slideUp(500); }
                    });


                },200);
            }
        }

        function file_not_exist(){
            console.log('file not exist');
            var first_start = "<div class='first-start'><span>Hey ! It's your first boot ?</span> OK, start to add data in your app...</div>";
            $('.js-load-page').html(first_start)
        }

    });
})( jQuery );
</script>
